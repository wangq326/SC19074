---
title: "Homework of Chap 9"
author: '19074'
date: "2019/12/2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Exercise 9.4

Implement a random walk Metropolis sampler for generating the standard Laplace distribution (see Exercise 3.2). For the increment, simulate from a normal distribution. Compare the chains generated when different variances are used for the proposal distribution. Also, compute the acceptance rates of each chain.

+ Recall : The standard Laplace distribution has density $f(x)=\frac{1}{2}e^{-|x|}, x\sim\mathbb{R}$. 

## Answer

```{r}
lap.f <- function(x){
  # prop density function of Laplace distribution
  return(1/2*exp(-abs(x)))
}
```

```{r}
random.walk.Me <- function(sigma, x0, N){ 
  # function to generate a random walk metropolis chain
  x <- numeric(N) 
  x[1] <- x0 
  u <- runif(N) 
  k <- 0 
  for (i in 2:N){ 
    y <- rnorm(1, x[i-1], sigma) 
    if (u[i] <= (lap.f(y)/lap.f(x[i-1]))){
      x[i] <- y 
    }else{ 
      x[i] <- x[i-1] 
      k <- k + 1 } 
    } 
  return(list(x=x, k=k)) 
} 

N <- 2000 
sigma <- c(.05, .5, 2, 16)
x0 <- 25 
rw1 <- random.walk.Me(sigma[1], x0, N) 
rw2 <- random.walk.Me(sigma[2], x0, N) 
rw3 <- random.walk.Me(sigma[3], x0, N) 
rw4 <- random.walk.Me(sigma[4], x0, N)
```

+ Compare the chains generated when different variances are used for the proposal distribution. 

+ The inverse of the cumulative distribution function of the standard Laplace distribution is $$F^{-1}(p)=-sign(p-0.5)ln(1-2|p-0.5|).$$ So we use $2.5\%$ quantile and $97.5\%$ quantile as reference lines.

```{r}
inverse.F <- function(p){
  if(p>=0.5){
     perc <- -log(1-2*abs(p-0.5))
  }else{perc <- log(1-2*abs(p-0.5))}
  return(perc) 
}
perc1 <- inverse.F(0.025)
perc2 <- inverse.F(0.975)
par(mfrow=c(2,2))
plot((1:N),rw1$x,type = "l",main = expression(paste(sigma,"=",0.05)))
abline(h=perc1)
abline(h=perc2)
plot((1:N),rw2$x,type = "l",main = expression(paste(sigma,"=",0.5)))
abline(h=perc1)
abline(h=perc2)
plot((1:N),rw3$x,type = "l",main = expression(paste(sigma,"=",2)))
abline(h=perc1)
abline(h=perc2)
plot((1:N),rw4$x,type = "l",main = expression(paste(sigma,"=",16)))
abline(h=perc1)
abline(h=perc2)
```

Compute the acceptance rates of each chain.

```{r}
rw.k <- c(rw1$k, rw2$k, rw3$k, rw4$k)
rate.acceptance <- (N-rw.k)/N
rbind(sigma,rate.acceptance)
```

We will find that as the variance becomes larger, the Markov chain converges quickly, but the acceptance rate will also drop quickly.


